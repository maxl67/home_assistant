id: weather
title: Wetter
path: weather
icon: mdi:weather-partly-cloudy
cards:
  # show weather alerts (if current_warn_count > 0)
  - type: conditional
    conditions:
      - entity: sensor.dwd_current_warn_count
        state_not: '0'
    card:
      type: custom:vertical-stack-in-card
      #title: Deutscher Wetterdienst  #title is too big here...
      cards:
        # show warning count and status received from DWD
        - type: custom:fold-entity-row
          head:
            type: section
            label: Wetterwarnungen & Alarm
          open: false
          entities:
            - entity: sensor.dwd_current_warn_count
              type: custom:multiple-entity-row
              name: DWD Meldungen aktuell
              secondary_info: last-changed
              primary:
            #    entity: sensor.dwd_advance_warn_count
            #    name: bald
            #  secondary:
                entity: sensor.dwd_current_warn_level
                name: DWD lvl
              secondary:
                entity: sensor.dwd_max_warn_level
                name: max lvl
            - entity: sensor.dwd_current_warn_gewitter 
              type: custom:multiple-entity-row
              name: Gewitter-Warnung
              icon: mdi:weather-lightning-rainy
              primary:
                entity: sensor.dwd_current_warn_level_gewitter
                name: Level
            - entity: sensor.dwd_current_warn_sturm 
              type: custom:multiple-entity-row
              name: Sturm-Warnung
              icon: mdi:weather-windy
              primary:
                entity: sensor.dwd_current_warn_level_sturm
                name: Level
            - entity: sensor.dwd_current_warn_regen
              type: custom:multiple-entity-row
              name: Regen-Warnung
              icon: mdi:weather-pouring
              primary:
                entity: sensor.dwd_current_warn_level_regen
                name: Level
            - entity: sensor.dwd_current_warn_schnee
              type: custom:multiple-entity-row
              name: Schnee-Warnung
              icon: mdi:weather-snowy-heavy
              primary:
                entity: sensor.dwd_current_warn_level_schnee
                name: Level
            - entity: sensor.dwd_current_warn_frost
              type: custom:multiple-entity-row
              name: Frost-Warnung
              icon: mdi:thermometer-alert
              primary:
                entity: sensor.dwd_current_warn_level_frost
                name: Level
            - entity: sensor.dwd_current_warn_glaette
              type: custom:multiple-entity-row
              name: Glatteis-Warnung
              icon: mdi:snowflake-alert
              primary:
                entity: sensor.dwd_current_warn_level_glaette
                name: Level
            - entity: input_boolean.dwd_weather_alert
              type: custom:multiple-entity-row
              name: Wetter Alarm
              secondary_info: last-changed
              primary:
                entity: sensor.count_notification_alerts
                name: Anz. Alarme

        # show the text of all DWD warnings
        - type: divider
        - type: markdown
          content: >
              <h3>{{ states.sensor.dwd_weather_warnings_current_warning_level.attributes.region_name }}</h3>
              {% if states.sensor.dwd_weather_warnings_current_warning_level.attributes.warning_1_headline is defined %}
                <h3>{{ states.sensor.dwd_weather_warnings_current_warning_level.attributes.warning_1_headline }}</h3>
                Warnstufe: {{ states.sensor.dwd_weather_warnings_current_warning_level.attributes.warning_1_level }}
                <br>
                Von: {{ as_timestamp(states.sensor.dwd_weather_warnings_current_warning_level.attributes.warning_1_start) | timestamp_custom("%a %d.%m.%Y %H:%M",true) }}
                <br>
                Bis: {{ as_timestamp(states.sensor.dwd_weather_warnings_current_warning_level.attributes.warning_1_end) | timestamp_custom("%a %d.%m.%Y %H:%M",true) }}
                <br>
                {{ states.sensor.dwd_weather_warnings_current_warning_level.attributes.warning_1_description }}
                <br>
                <br>
              {% endif %}
              {% if states.sensor.dwd_weather_warnings_current_warning_level.attributes.warning_2_headline is defined %}
                <h3>{{ states.sensor.dwd_weather_warnings_current_warning_level.attributes.warning_2_headline }}</h3>
                Warnstufe: {{ states.sensor.dwd_weather_warnings_current_warning_level.attributes.warning_2_level }}
                <br>
                Von: {{ as_timestamp(states.sensor.dwd_weather_warnings_current_warning_level.attributes.warning_2_start) | timestamp_custom("%a %d.%m.%Y %H:%M",true) }}
                <br>
                Bis: {{ as_timestamp(states.sensor.dwd_weather_warnings_current_warning_level.attributes.warning_2_end) | timestamp_custom("%a %d.%m.%Y %H:%M",true) }}
                <br>
                {{ states.sensor.dwd_weather_warnings_current_warning_level.attributes.warning_2_description }}
                <br>
                <br>
              {% endif %}
              {% if states.sensor.dwd_weather_warnings_current_warning_level.attributes.warning_3_headline is defined %}
                <h3>{{ states.sensor.dwd_weather_warnings_current_warning_level.attributes.warning_3_headline }}</h3>
                Warnstufe: {{ states.sensor.dwd_weather_warnings_current_warning_level.attributes.warning_3_level }}
                <br>
                Von: {{ as_timestamp(states.sensor.dwd_weather_warnings_current_warning_level.attributes.warning_3_start) | timestamp_custom("%a %d.%m.%Y %H:%M",true) }}
                <br>
                Bis: {{ as_timestamp(states.sensor.dwd_weather_warnings_current_warning_level.attributes.warning_3_end) | timestamp_custom("%a %d.%m.%Y %H:%M",true) }}
                <br>
                {{ states.sensor.dwd_weather_warnings_current_warning_level.attributes.warning_3_description }}
                <br>
                <br>
              {% endif %}
              {% if states.sensor.dwd_weather_warnings_current_warning_level.attributes.warning_4_headline is defined %}
                <h3>{{ states.sensor.dwd_weather_warnings_current_warning_level.attributes.warning_4_headline }}</h3>
                Warnstufe: {{ states.sensor.dwd_weather_warnings_current_warning_level.attributes.warning_4_level }}
                <br>
                Von: {{ as_timestamp(states.sensor.dwd_weather_warnings_current_warning_level.attributes.warning_4_start) | timestamp_custom("%a %d.%m.%Y %H:%M",true) }}
                <br>
                Bis: {{ as_timestamp(states.sensor.dwd_weather_warnings_current_warning_level.attributes.warning_4_end) | timestamp_custom("%a %d.%m.%Y %H:%M",true) }}
                <br>
                {{ states.sensor.dwd_weather_warnings_current_warning_level.attributes.warning_4_description }}
                <br>
                <br>
              {% endif %}
              <a href="http://www.dwd.de/DWD/warnungen/warnapp_gemeinden/json/warnungen_gemeinde_map_baw.png">Aktuelle Warnkarte</a>
              <br>

  # current weather info and forcast
  - type: custom:weather-card-chart
    #title: home
    weather: weather.dark_sky_daily
    sun: sun.sun
    mode: daily #hourly|daily  - hourly display is not good.
    locale: 'de-DE'

  # 3 different satelite pictures (rain, clouds, snow); can be toggled by tapping on them. 
  - type: custom:vertical-stack-in-card
    cards:
    - type: conditional
      conditions:
        - entity: input_select.type_of_satelite  #value stored the current selection
          state: "Bewölkung"
      card:
        type: picture-entity
        entity: camera.satelite_clouds
        name: Bewölkung #clouds
        show_state: false
        tap_action:
          action: call-service
          service: input_select.select_next
          service_data:
            entity_id: input_select.type_of_satelite
    - type: conditional
      conditions:
        - entity: input_select.type_of_satelite
          state: "Regen"
      card:
        type: picture-entity
        entity: camera.satelite_rain
        name: Regen #rain
        show_state: false
        tap_action:
          action: call-service
          service: input_select.select_next
          service_data:
            entity_id: input_select.type_of_satelite            
    - type: conditional
      conditions:
        - entity: input_select.type_of_satelite
          state: "Schnee"
      card:
        type: picture-entity
        entity: camera.satelite_snow
        name: Schnee #snow
        show_state: false
        tap_action:
          action: call-service
          service: input_select.select_next
          service_data:
            entity_id: input_select.type_of_satelite
#test
#  - type: glance
#    title: Auswahl
#    entities:
#      - entity: input_select.type_of_satelite