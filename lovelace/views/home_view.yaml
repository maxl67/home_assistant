anchors:
  style_entitycard_header: &style_header
    card_mod: 
      style: |
        .card-header {
          font-size: 20px;
          padding: 10px 16px;
        }

#==================================================
#id: home
title: Home
icon: mdi:home
#todo: does not work this way
#icon: >
#  {% if is_state('input_boolean.open_backdoor_alert', 'on') or is_state('input_boolean.open_window_alert', 'on') %}
#    mdi:home-alert
#  {% else %}
#    mdi:home
#  {% endif %}
path: home
cards:
  #------------------------------------------------
  # show warnings & alarms
  - type: custom:auto-entities
    show_empty: false
    card:
      type: entities
      title: Alarme und Warnungen
      show_header_toggle: false
    filter:
      include:
        - entity_id: "binary_sensor.warn*"
          state: 'on'
        - entity_id: "input_boolean.alert_*"
          state: 'on'
        - entity_id: "binary_sensor.alert_*"
          state: 'on'
        - entity_id: binary_sensor.fritz_box_6490_cable_firmware_update
          state: 'on'
        - entity_id: binary_sensor.fritz_box_6490_cable_connection
          state: 'off'
        - entity_id: sensor.hacs
          state: '> 0'
#        - entity_id: switch.adguard_protection
#          state: 'off'
        - entity_id: "sensor.dwd_current_warn_level_*"
          state: '>= 2'
        - entity_id: binary_sensor.hera_update_available
          state: 'on'
      template: |
        {% if states('sensor.latest_version') <> states('sensor.current_version') %}
          {{ sensor.latest_version.entity_id }}
        {% endif %}      

  #------------------------------------------------
  # only show open (or unavailable) door-/window sensors (if any...)
  - type: custom:auto-entities
    show_empty: false
    card:
      type: entities
      title: Offene Türen
      show_header_toggle: false
    filter:
      include:
        - entity_id: "binary_sensor.lumi_lumi_sensor_magnet_aq2*"
          state: "on"
        - entity_id: "binary_sensor.lumi_lumi_sensor_magnet_aq2*"
          state: "unavailable"

  #------------------------------------------------
  # show low battery devices (if any...)
  - type: custom:auto-entities
    show_empty: false
    card:
      type: entities
      title: Low Battery Devices
      show_header_toggle: false
    filter:
      exclude:
        - entity_id: "sensor.*iphone*"
        - entity_id: "sensor.*ipad*"
        - entity_id: "input*"
        - entity_id: "sensor.plant_*_battery" #old remains of battery notification package
        - entity_id: "plant.plant_*_battery" #old remains of battery notification package
        - entity_id: "sensor.oleander_battery" #old remains of battery notification package
      include:
        - entity_id: "sensor.lumi_lumi_sensor_magnet_aq2*"
          state: "<= 10" #Door- & window sensors
        - entity_id: "sensor.lumi_lumi_weather_*_power"
          state: "<= 10" #Climate sensor
        - entity_id: "*battery*"
          state: "<= 15"
        - name: "*battery*"
          state: "< 15"
        - attributes:
            battery: "< 15"
        - entity_id: "*low_bat"
          state: "on"
        #- attributes: #here the vacuum will show with status 'charging' etc.
        #    battery_level: < 20

  #------------------------------------------------
  # show persons and home status
  - type: custom:vertical-stack-in-card
    cards:
      - type: glance
        title: Anwesenheit
        state_color: true
        columns: 4
        entities:
          - entity: sensor.max_status
          - entity: sensor.ing_status
          - entity: sensor.home_status
            type: custom:multiple-entity-row
            name: Family
      - type: entities
        show_header_toggle: false
        state_color: true
        entities:
          - type: divider
          - entity: input_boolean.guests

  #------------------------------------------------
  # show events from home-calendar (if any)
#  - type: conditional
#    conditions:
#      - entity: calendar.home
#        state_not: 'off'
#    card:
  - type: custom:calendar-card # more compact, but not maintained anymore, switch to ...
  #- type: calendar # ...official card, uses lot of space.
    title: 'Home-Kalender'
    initial_view: listWeek #list_view
    entities:
      - calendar.home
      - calendar.privat_max

  #------------------------------------------------
  # status of power switches 
  - type: entities
    title: Power
    show_header_toggle: false
    state_color: true
    entities:
      - entity: switch.ikea_of_sweden_tradfri_control_outlet_switch #switch.osram_plug_01_a1bf020a_3
        name: HiFi & TV
        #icon on:  mdi:television-speaker
        #icon off: mdi:television-speaker-off
      - entity: switch.fritz_dect_200_netz
        name: Network-Rack
      - entity: switch.fritz_dect_200_gz
        name: Schreibtisch Max
      - type: divider
      - entity: switch.enable_power_automation

  #------------------------------------------------
  # status of lights
  - type: entities
    title: Licht
    show_header_toggle: false
    state_color: true
#  card_mod:
#    style: |
#      ha-card {
#        background: url("/local/lampe.png");
#        background-size: 60% 120px;
#        background-position: center;
#        background-repeat: no-repeat;
#        --primary-text-color: var(--primary-text-color);
#        --secondary-text-color: var(--secondary-text-color);
#        --paper-item-icon-color: var(--primary-text-color);
#      }
    entities:
      - type: custom:slider-entity-row
        entity: light.0008da499c8dbd
        name: Ambiente Wohnen
        toggle: true
        hide_when_off: false
        min: 25
        max: 100
      - type: custom:slider-entity-row
        entity: light.0008dd899c4781
        name: Kiesel Büro
        toggle: true
        hide_when_off: false
      - type: custom:slider-entity-row
        entity: light.philips_lightstrip_ku
        name: Lichtsteifen Küche
        toggle: true
        hide_when_off: true
      - type: divider
      - entity: switch.enable_light_automation

  #------------------------------------------------
  # operation and options for blinds
  - !include ../cards/jalousien.yaml

  #------------------------------------------------
  - type: conditional
    conditions:
#todo: should be OR or template with .. in ['all','home'], but is not possible (v2021.11)
      - entity: input_select.debug_mode
        state: 'home'
    card:
      type: vertical-stack
      cards:
        # device tracking status (fosr testing)
        - !include ../cards/devicetracker_debug.yaml

        # all door- and window sensors (while implementing)
        - !include ../cards/doors_debug.yaml