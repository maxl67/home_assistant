anchors:
  style_entitycard_header: &style_header
    card_mod: 
      style: |
        .card-header {
          font-size: 20px;
          padding: 10px 16px;
        }

#==================================================
#id: home
title: Home
icon: mdi:home
#todo: does not work this way
#icon: >
#  {% if is_state('input_boolean.open_backdoor_alert', 'on') or is_state('input_boolean.open_window_alert', 'on') %}
#    mdi:home-alert
#  {% else %}
#    mdi:home
#  {% endif %}
path: home
cards:

  # Parameter der Jalousiensteuerung
  - type: custom:vertical-stack-in-card
    cards:
      - type: entities
        title: Jalousien
        state_color: false
        entities:
          # - type: custom:slider-entity-row
          #   entity: cover.00165d89bbacfa_2
          #   name: Esszimmer
          # - type: divider
          - entity: cover.00165d89bbacf5_2
            name: Büro
            secondary_info: position
            style: |
              :host {
                {% if state_attr('cover.00165d89bbacf5_2','current_position')|int <=95  %}
                  --paper-item-icon-color: var(--paper-item-icon-active-color);
                {% else %}
                  --paper-item-icon-color: var(--primary-text-color);
                {% endif %}
              }
          - entity: cover.00165d89bbacfa_6
            name: Küche
            secondary_info: position
            style: |
              :host {
                {% if state_attr('cover.00165d89bbacfa_6','current_position')|int <=95  %}
                  --paper-item-icon-color: var(--paper-item-icon-active-color);
                {% else %}
                  --paper-item-icon-color: var(--primary-text-color);
                {% endif %}
              }
          - entity: cover.00165d89bbacfa_2
            name: Esszimmer
            secondary_info: position
            style: |
              :host {
                {% if state_attr('cover.00165d89bbacfa_2','current_position')|int <=95  %}
                  --paper-item-icon-color: var(--paper-item-icon-active-color);
                {% else %}
                  --paper-item-icon-color: var(--primary-text-color);
                {% endif %}
              }
          - entity: cover.00165d89bbacfa_14
            name: Wohnen Süd
            secondary_info: position
            style: |
              :host {
                {% if state_attr('cover.00165d89bbacfa_14','current_position')|int <=95  %}
                  --paper-item-icon-color: var(--paper-item-icon-active-color);
                {% else %}
                  --paper-item-icon-color: var(--primary-text-color);
                {% endif %}
              }
          - entity: cover.00165d89bbacfa_10
            name: Wohnen West
            secondary_info: position
            style: |
              :host {
                {% if state_attr('cover.00165d89bbacfa_10','current_position')|int <=95  %}
                  --paper-item-icon-color: var(--paper-item-icon-active-color);
                {% else %}
                  --paper-item-icon-color: var(--primary-text-color);
                {% endif %}
              }
          - entity: cover.00165d89bbacf5_6
            name: Wohnen Nord
            secondary_info: position
            style: |
              :host {
                {% if state_attr('cover.00165d89bbacf5_6','current_position')|int <=95  %}
                  --paper-item-icon-color: var(--paper-item-icon-active-color);
                {% else %}
                  --paper-item-icon-color: var(--primary-text-color);
                {% endif %}
              }
          - type: divider
          - type: buttons
            entities:
              - name: alles hoch/rein
                entity: script.retract_covers_on_side
                icon: mdi:blinds-open
                tap_action: 
                  action: call-service
                  service: script.retract_covers_on_side
                double_tap_action: 
                  action: call-service
                  service: script.stop_covers
                  confirmation: 
                    text: Sollen alle Jalousien und Markisen angehalten werden?
              - name: Süden zu
                entity: script.lower_all_covers_on_side
                icon: mdi:blinds-horizontal-closed
                tap_action: 
                  action: call-service
                  service: script.lower_all_covers_on_side
                  data:
                    in_south: true
                    in_west: false
                double_tap_action: 
                  action: call-service
                  service: script.stop_covers
                  data:
                    in_south: true
                    in_west: false
                  confirmation: 
                    text: Sollen die Jalousien nach Süden angehalten werden?
              - name: Westen zu
                entity: script.lower_all_covers_on_side
                icon: mdi:roller-shade-closed
                tap_action: 
                  action: call-service
                  service: script.lower_all_covers_on_side
                  data:
                    in_south: false
                    in_west: true
                double_tap_action: 
                  action: call-service
                  service: script.stop_covers
                  data:
                    in_south: false
                    in_west: true
                  confirmation: 
                    text: Sollen die Jalousien nach Westen angehalten werden?
          - type: section
          - entity: switch.enable_jalousie_automation
            toggle: true
            state_color: true
            name: Automatische Beschattung #automate covers

    # options for blinds (only if activated)
      - type: conditional
        state_color: true
        conditions:
          - entity: input_boolean.automate_jalousie
            state: 'on'
        card:
          type: entities
          title: ' '
          show_header_toggle: false
          card_mod:
            style: |
              ha-card .card-header {
                padding: 0px;
                display: unset;
          entities:
            # configuration
            - type: custom:fold-entity-row
              head:
                type: section
                label: Steuerung  # configuration
              padding: 0 px
              open: false
              entities:
                - entity: switch.automatic_shade_when_home
                  type: custom:multiple-entity-row
                  toggle: true
                  state_color: true
                - entity: switch.cover_only_when_sunshine
                  name: nur bei Sonnenschein 
                  toggle: true
                  state_color: true


  #------------------------------------------------
  # show warnings & alarms
  - type: custom:auto-entities
    show_empty: false
    card:
      type: entities
      title: Alarme und Warnungen
      show_header_toggle: false
    filter:
      include:
        - entity_id: "binary_sensor.warn*"
          state: 'on'
        - entity_id: "input_boolean.alert_*"
          state: 'on'
        - entity_id: "binary_sensor.alert_*"
          state: 'on'
        - entity_id: binary_sensor.fritz_box_6490_cable_firmware_update
          state: 'on'
        - entity_id: binary_sensor.fritz_box_6490_cable_connection
          state: 'off'
        - entity_id: sensor.hacs
          state: '> 0'
#        - entity_id: switch.adguard_protection
#          state: 'off'
        - entity_id: "sensor.dwd_current_warn_level_*"
          state: '>= 2'
        - entity_id: binary_sensor.hera_update_available
          state: 'on'
      template: |
        {% if states('sensor.latest_version') <> states('sensor.current_version') %}
          {{ sensor.latest_version.entity_id }}
        {% endif %}      

  #------------------------------------------------
  # only show open (or unavailable) door-/window sensors (if any...)
  - type: custom:auto-entities
    show_empty: false
    card:
      type: entities
      title: Offene Türen
      show_header_toggle: false
    filter:
      include:
        - entity_id: "binary_sensor.lumi_lumi_sensor_magnet_aq2*"
          state: "on"
        - entity_id: "binary_sensor.lumi_lumi_sensor_magnet_aq2*"
          state: "unavailable"

  #------------------------------------------------
  # show low battery devices (if any...)
  - type: custom:auto-entities
    show_empty: false
    card:
      type: entities
      title: Low Battery Devices
      show_header_toggle: false
    filter:
      exclude:
        - entity_id: "sensor.*iphone*"
        - entity_id: "sensor.*ipad*"
        - entity_id: "input*"
        - entity_id: "sensor.plant_*_battery" #old remains of battery notification package
        - entity_id: "plant.plant_*_battery" #old remains of battery notification package
        - entity_id: "sensor.oleander_battery" #old remains of battery notification package
      include:
        - entity_id: "sensor.lumi_lumi_sensor_magnet_aq2*"
          state: "<= 10" #Door- & window sensors
        - entity_id: "sensor.lumi_lumi_weather_*_power"
          state: "<= 10" #Climate sensor
        - entity_id: "*battery*"
          state: "<= 15"
        - name: "*battery*"
          state: "< 15"
        - attributes:
            battery: "< 15"
        - entity_id: "*low_bat"
          state: "on"
        #- attributes: #here the vacuum will show with status 'charging' etc.
        #    battery_level: < 20

  #------------------------------------------------
  # show persons and home status
  - type: custom:vertical-stack-in-card
    cards:
      - type: glance
        title: Anwesenheit
        state_color: true
        columns: 4
        entities:
          - entity: sensor.max_status
          - entity: sensor.ing_status
          - entity: sensor.home_status
            type: custom:multiple-entity-row
            name: Family
      - type: entities
        show_header_toggle: false
        state_color: true
        entities:
          - type: divider
          - entity: input_boolean.guests


  #------------------------------------------------
  # show events from home-calendar (if any)
#  - type: conditional
#    conditions:
#      - entity: calendar.home
#        state_not: 'off'
#    card:
  - type: custom:calendar-card # more compact, but not maintained anymore, switch to ...
  #- type: calendar # ...official card, uses lot of space.
    title: 'Home-Kalender'
    initial_view: listWeek #list_view
    entities:
      - calendar.home
      - calendar.privat_max

  #------------------------------------------------
  # status of power switches 
  - type: entities
    title: Power
    show_header_toggle: false
    state_color: true
    entities:
      - entity: switch.osram_plug_01_a1bf020a_3
        name: HiFi & TV
        #icon on:  mdi:television-speaker
        #icon off: mdi:television-speaker-off
      - entity: switch.fritz_dect_200_netz
        name: Network-Rack        
      - entity: switch.fritz_dect_200_gz
        name: Schreibtisch Max
      - type: divider
      - entity: switch.enable_power_automation

  #------------------------------------------------
  # status of lights
  - type: entities
    title: Licht
    show_header_toggle: false
    state_color: true
#  card_mod:
#    style: |
#      ha-card {
#        background: url("/local/lampe.png");
#        background-size: 60% 120px;
#        background-position: center;
#        background-repeat: no-repeat;
#        --primary-text-color: var(--primary-text-color);
#        --secondary-text-color: var(--secondary-text-color);
#        --paper-item-icon-color: var(--primary-text-color);
#      }
    entities:
      - type: custom:slider-entity-row
        entity: light.0008da499c8dbd
        name: Ambiente Wohnen
        toggle: true
        hide_when_off: false
      - type: custom:slider-entity-row
        entity: light.0008dd899c4781
        name: Kiesel Büro
        toggle: true
        hide_when_off: false
        min: 10
        max: 50
      - type: custom:slider-entity-row
        entity: light.philips_lightstrip_ku
        name: Lichtsteifen Küche
        toggle: true
        hide_when_off: true
      - type: divider
      - entity: switch.enable_light_automation

  #------------------------------------------------
  - type: conditional
    conditions:
#todo: should be OR or template with .. in ['all','home'], but is not possible (v2021.11)
      - entity: input_select.debug_mode
        state: 'home'
    card:
      type: vertical-stack
      cards:
        # device tracking status (fosr testing)
        - !include ../cards/devicetracker_debug.yaml

        # all door- and window sensors (while implementing)
        - !include ../cards/doors_debug.yaml